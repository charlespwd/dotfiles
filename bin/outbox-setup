#!/bin/bash
cd /home/charles/ws/outbox/es5;

SESSION_NAME='outbox'

tmux has-session -t ${SESSION_NAME}

if [ $? != 0 ]; then

  # start nginx
  sudo systemctl start nginx

  # create the session
  tmux new-session -s ${SESSION_NAME} -n vim -d

  # first window, vim.
  tmux send-keys -t ${SESSION_NAME}:1 'vim' C-m

  # build window
  tmux new-window -n 'build' -t ${SESSION_NAME}
  tmux send-keys -t ${SESSION_NAME}:2 'swd' C-m

  # test window
  tmux new-window -n 'tests' -t ${SESSION_NAME}
  tmux send-keys -t ${SESSION_NAME}:3 'npm run test-watch' C-m

  # watchme window
  tmux new-window -n 'watchme' -t ${SESSION_NAME}
  tmux send-keys -t ${SESSION_NAME}:4 'j ws; node oss/watchme/index.js "outbox/es5/{src,css}/**/*.{js,jsx,scss}"' C-m

  # start in vim
  tmux select-window -t ${SESSION_NAME}:1
fi

tmux attach -t ${SESSION_NAME}
