#!/bin/env bash

set -e

if [[ $(lpass status) = 'Not logged in.' ]]; then
  if [ -n $LPASS_USERNAME ]; then
    lpass login $LPASS_USERNAME
  else
    notify-send 'LastPass' 'Please login first.'
    exit 0
  fi
fi

set +e

menu="rofi -dmenu -i -matching fuzzy -levenshtein-sort -p lpass"
passinfo=$(lpass ls --format '%an - %au - %ai' | $menu)
passid=$(echo "$passinfo" | awk -F' - ' '{ print $3 }')
echo -n $(lpass show -p $passid) | xclip -i -selection clipboard

$HOME/bin/clear-clipboard &
disown
