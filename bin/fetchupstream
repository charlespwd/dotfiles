#!/bin/bash

has_develop() {
  git branch | grep -q develop
}

if [[ $1 != '-n' ]] && [[ $1 != '' ]]; then
  echo "Usage: fetchupstream [-n]"
  exit 1
fi

if [[ $1 != '-n' ]]; then
  # gwip
  git add -A
  git rm $(git ls-files --deleted) 2> /dev/null
  git commit --no-verify -m "--wip-- [skip ci]"
fi

upstream=$(git remote | grep upstream | head -n 1)
remote="${upstream:-origin}"
branch="$(has_develop && echo "develop" || echo "master")"

set -e

git checkout $branch
git fetch $remote
git fetch --tags $remote
git reset --hard $remote/$branch
if [[ $remote != 'origin' ]]; then
  git push -f origin $branch
fi;
