#!/bin/bash

if [[ $1 != '-n' ]] && [[ $1 != '' ]]; then
  echo "Usage: fetchupstream [-n]"
  exit 1
fi

if [[ $1 != '-n' ]]; then
  # gwip
  git add -A
  git rm $(git ls-files --deleted) 2> /dev/null
  git commit --no-verify -m "--wip-- [skip ci]"
fi

upstream=$(git remote | grep upstream | head -n 1)
remote="${upstream:-origin}"

set -e

git checkout master
git fetch $remote
git fetch --tags $remote
git reset --hard $remote/master
if [[ $remote != 'origin' ]]; then
  git push -f origin master
fi;
